<html>
    <head>
        <style>
            body {
                font-family:Verdana, Geneva, Tahoma, sans-serif
            }
            h1 {
                font-weight: normal
            }
            button {
                padding: 10px;
            }
        </style>
        <script src="md5.min.js"></script>
        <script>
            function turnOn() {
                var marker_count = document.getElementById('marker_count').value
                if (parseInt(marker_count) <= 0) {
                    alert("Please enter a number of markers greater than 0!")
                } else {
                    console.log("Turn On!")
                    var url = "http://localhost:9000/turnon/" + marker_count;
                    var xmlhttp = new XMLHttpRequest();   // new HttpRequest instance 
                    xmlhttp.onreadystatechange = function () {
                        if(xmlhttp.readyState === 4) {
                            console.log(xmlhttp.responseText);
                        }
                    };
                    xmlhttp.open("PUT", url);
                    xmlhttp.send();
                }
            }
            function turnOff() {
                console.log("Turn off!")
                var url = "http://localhost:9000/turnoff";
                var xmlhttp = new XMLHttpRequest();   // new HttpRequest instance 
                xmlhttp.onreadystatechange = function () {
                    if(xmlhttp.readyState === 4) {
                        console.log(xmlhttp.responseText);
                    }
                };
                xmlhttp.open("PUT", url);
                xmlhttp.send();
            }
        </script>
    </head>
    <body>
        <h1>Start BOB!</h1>
        <div><span>Marker Count: </span><input id='marker_count'></input></div>
        <button onclick="turnOn()">Start!</button>
        <h1>Stop BOB!</h1>
        <button onclick="turnOff()">Stop!</button>
        <h1>Login</h1>
        <input id="username" type="email" placeholder="Username"></input>
        <input id="password" type="password" placeholder="Password"></input>
        <div style="display: flex; flex-direction: row;">
            <button id="login">Login</button>
            <button id="register">Register</button>
        </div>
        <script>
            document.querySelector('#login').onclick = () => {
                console.log('Pressed login')
                const body = {
                    username: document.querySelector('#username').value,
                    password: md5(document.querySelector('#username').value)
                }
                fetch('http://localhost:9000/login', {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(body)
                })
                .then(res => res.json())
                .then(json => {
                    console.log(json)
                    if (json.loggedIn) {
                        alert('Successfully logged in as ' + body.username + '.')
                    } else if (json.success) {
                        alert('Wrong username or password')
                    } else {
                        alert('Login error. See logs.')
                    }
                })
                .catch(err => console.error(err) || alert('Login error. See logs.'))
            }
            
            document.querySelector('#register').onclick = () => {
                console.log('Pressed register')
                const body = {
                    username: document.querySelector('#username').value,
                    password: md5(document.querySelector('#username').value)
                }
                fetch('http://localhost:9000/register', {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(body)
                })
                .then(res => res.json())
                .then(json => {
                    console.log(json)
                    if (json.success) {
                        alert('Successfully registered as ' + body.username + '.')
                    } else {
                        alert('Register error. See logs.')
                    }
                })
                .catch(err => console.error(err) || alert('Login error. See logs.'))
            }
        </script>
    </body>
</html>